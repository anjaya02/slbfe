<div class="reports-page">
  <div class="page-header">
    <h1>Reports</h1>
    <div class="header-actions">
      <button mat-stroked-button (click)="exportCSV()" [disabled]="!reportData">
        <mat-icon>download</mat-icon> Export CSV
      </button>
      <button
        mat-raised-button
        class="btn-primary"
        (click)="exportPDF()"
        [disabled]="!reportData"
      >
        <mat-icon>picture_as_pdf</mat-icon> Export PDF
      </button>
    </div>
  </div>

  <!-- Filters -->
  <div class="filter-bar">
    <mat-form-field appearance="outline">
      <mat-label>Report Type</mat-label>
      <mat-select [(value)]="selectedReportType">
        <mat-option *ngFor="let rt of reportTypes" [value]="rt.value">{{
          rt.label
        }}</mat-option>
      </mat-select>
    </mat-form-field>

    <mat-form-field
      appearance="outline"
      *ngIf="selectedReportType === 'CUSTOM'"
    >
      <mat-label>Start Date</mat-label>
      <input matInput [matDatepicker]="startPicker" [(ngModel)]="startDate" />
      <mat-datepicker-toggle
        matSuffix
        [for]="startPicker"
      ></mat-datepicker-toggle>
      <mat-datepicker #startPicker></mat-datepicker>
    </mat-form-field>

    <mat-form-field
      appearance="outline"
      *ngIf="selectedReportType === 'CUSTOM'"
    >
      <mat-label>End Date</mat-label>
      <input matInput [matDatepicker]="endPicker" [(ngModel)]="endDate" />
      <mat-datepicker-toggle
        matSuffix
        [for]="endPicker"
      ></mat-datepicker-toggle>
      <mat-datepicker #endPicker></mat-datepicker>
    </mat-form-field>

    <button mat-raised-button class="btn-generate" (click)="generateReport()">
      <mat-icon>assessment</mat-icon> Generate
    </button>
  </div>

  <!-- Loading -->
  <div class="loading-state" *ngIf="loading">
    <mat-spinner diameter="48"></mat-spinner>
  </div>

  <!-- Report Content -->
  <div class="report-content" *ngIf="reportData && !loading">
    <!-- Summary Cards -->
    <div class="summary-cards">
      <div class="summary-card card-blue">
        <div class="card-icon"><mat-icon>assignment</mat-icon></div>
        <div class="card-info">
          <span class="card-label">Total Cases</span>
          <span class="card-value">{{ reportData.summary.totalCases }}</span>
        </div>
      </div>
      <div class="summary-card card-green">
        <div class="card-icon"><mat-icon>check_circle</mat-icon></div>
        <div class="card-info">
          <span class="card-label">Resolved</span>
          <span class="card-value">{{ reportData.summary.resolvedCases }}</span>
        </div>
      </div>
      <div class="summary-card card-orange">
        <div class="card-icon"><mat-icon>pending</mat-icon></div>
        <div class="card-info">
          <span class="card-label">Pending</span>
          <span class="card-value">{{ reportData.summary.pendingCases }}</span>
        </div>
      </div>
      <div class="summary-card card-purple">
        <div class="card-icon"><mat-icon>timer</mat-icon></div>
        <div class="card-info">
          <span class="card-label">Avg Resolution</span>
          <span class="card-value"
            >{{ reportData.summary.averageResolutionDays }} days</span
          >
        </div>
      </div>
    </div>

    <!-- Charts -->
    <div class="chart-grid">
      <div class="chart-card">
        <h3>Status Breakdown</h3>
        <div class="chart-wrapper">
          <canvas
            baseChart
            [data]="pieChartData"
            type="pie"
            [options]="pieChartOptions"
          >
          </canvas>
        </div>
      </div>

      <div class="chart-card">
        <h3>Monthly Trend</h3>
        <div class="chart-wrapper">
          <canvas
            baseChart
            [data]="lineChartData"
            type="line"
            [options]="lineChartOptions"
          >
          </canvas>
        </div>
      </div>
    </div>

    <!-- Officer Performance Table -->
    <div class="card performance-card">
      <h3>Officer Performance</h3>
      <table
        mat-table
        [dataSource]="reportData.officerPerformance"
        class="performance-table"
      >
        <ng-container matColumnDef="name">
          <th mat-header-cell *matHeaderCellDef>Officer</th>
          <td mat-cell *matCellDef="let row">{{ row.officerName }}</td>
        </ng-container>
        <ng-container matColumnDef="totalCases">
          <th mat-header-cell *matHeaderCellDef>Total Cases</th>
          <td mat-cell *matCellDef="let row">{{ row.casesHandled }}</td>
        </ng-container>
        <ng-container matColumnDef="resolved">
          <th mat-header-cell *matHeaderCellDef>Resolved</th>
          <td mat-cell *matCellDef="let row">{{ row.resolvedCases }}</td>
        </ng-container>
        <ng-container matColumnDef="avgDays">
          <th mat-header-cell *matHeaderCellDef>Avg Days</th>
          <td mat-cell *matCellDef="let row">{{ row.avgResolutionDays }}</td>
        </ng-container>
        <ng-container matColumnDef="rating">
          <th mat-header-cell *matHeaderCellDef>Rating</th>
          <td mat-cell *matCellDef="let row">
            <div class="rating-bar">
              <div
                class="rating-fill"
                [style.width.%]="row.satisfactionRating * 20"
              ></div>
            </div>
            <span class="rating-text">{{ row.satisfactionRating }}/5</span>
          </td>
        </ng-container>

        <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
        <tr mat-row *matRowDef="let row; columns: displayedColumns"></tr>
      </table>
    </div>
  </div>
</div>
