<div class="complaint-list-page">
  <div class="page-header">
    <h2 class="page-title">Problem List</h2>
  </div>

  <!-- Search & Filters -->
  <div class="filters-bar">
    <mat-form-field appearance="outline" class="search-field">
      <mat-icon matPrefix>search</mat-icon>
      <mat-label>Search by name or reference...</mat-label>
      <input matInput [(ngModel)]="searchValue" (keyup)="applyFilter()" />
    </mat-form-field>
  </div>

  <!-- Table -->
  <div class="table-card">
    <!-- Loading -->
    <app-loading *ngIf="loading" mode="inline" message="Fetching complaints..."></app-loading>

    <!-- Error -->
    <div
      class="error-state"
      *ngIf="!loading && error"
      style="text-align: center; padding: 48px 24px"
    >
      <mat-icon
        style="font-size: 48px; width: 48px; height: 48px; color: #ef4444"
        >error_outline</mat-icon
      >
      <h3>Failed to load complaints</h3>
      <p>Something went wrong while fetching complaints.</p>
      <button mat-raised-button color="primary" (click)="loadComplaints()">
        Retry
      </button>
    </div>

    <table
      mat-table
      [dataSource]="dataSource"
      matSort
      *ngIf="!loading && !error"
      class="complaint-table"
    >
      <!-- Worker Name -->
      <ng-container matColumnDef="workerName">
        <th mat-header-cell *matHeaderCellDef mat-sort-header>Worker's name</th>
        <td mat-cell *matCellDef="let row">{{ row.workerName }}</td>
      </ng-container>

      <!-- Reference No -->
      <ng-container matColumnDef="referenceNo">
        <th mat-header-cell *matHeaderCellDef mat-sort-header>Reference No</th>
        <td mat-cell *matCellDef="let row">
          <span class="ref-no">{{ row.referenceNo }}</span>
        </td>
      </ng-container>

      <!-- Date Submitted -->
      <ng-container matColumnDef="dateSubmitted">
        <th mat-header-cell *matHeaderCellDef mat-sort-header>
          Date Submitted
        </th>
        <td mat-cell *matCellDef="let row">
          {{ row.dateSubmitted | date: "dd/MM/yyyy" }}
        </td>
      </ng-container>

      <!-- Type -->
      <ng-container matColumnDef="type">
        <th mat-header-cell *matHeaderCellDef mat-sort-header>Type</th>
        <td mat-cell *matCellDef="let row">{{ $any(typeLabels)[row.type] }}</td>
      </ng-container>

      <!-- Status -->
      <ng-container matColumnDef="status">
        <th mat-header-cell *matHeaderCellDef mat-sort-header>Status</th>
        <td mat-cell *matCellDef="let row">
          <span class="status-badge" [ngClass]="getStatusClass(row.status)">{{
            row.status
          }}</span>
        </td>
      </ng-container>

      <!-- Action -->
      <ng-container matColumnDef="action">
        <th mat-header-cell *matHeaderCellDef></th>
        <td mat-cell *matCellDef="let row">
          <button
            mat-raised-button
            class="btn-view"
            (click)="viewComplaint(row)"
          >
            View
          </button>
        </td>
      </ng-container>

      <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
      <tr
        mat-row
        *matRowDef="let row; columns: displayedColumns"
        class="table-row"
      ></tr>
    </table>

    <mat-paginator
      [pageSizeOptions]="[10, 25, 50]"
      showFirstLastButtons
      *ngIf="!loading && !error"
    ></mat-paginator>
  </div>
</div>
